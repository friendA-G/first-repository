<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>快件e栈用户登陆</title>
<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport">
<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="black" name="apple-mobile-web-app-status-bar-style">
<meta content="telephone=no" name="format-detection">
<link href="css/style.css" rel="stylesheet" type="text/css">
    <style type="text/css">
        .code{
            text-align: center;
            margin-top: 10px;
        }
    </style>
</head>
<body style="">
<section class="aui-flexView">
<header class="aui-navBar aui-navBar-fixed">
<a href="javascript:;" class="aui-navBar-item">

</a>
<div class="aui-center">
<span class="aui-center-title"></span>
</div>
</header>
<section class="aui-scrollView">
<div class="aui-ver-head">
<img src="images/head.png" alt="">
</div>
<div class="aui-ver-form"><img class="logo" src="images/logo.png">
<div class="aui-flex">
<div class="aui-flex-box">
<i class="icon icon-phone"></i>
<input id="phone1" type="text" autocomplete="off" placeholder="手机号码">
</div>
</div>
<div class="aui-flex">
<div class="aui-flex-box">
<i class="icon icon-code"></i>
<input id="code1" type="text" autocomplete="off" placeholder="验证码">
</div>
<div class="aui-button-code">
<input id="btnSendCode1" type="button" class="btn btn-default" value="获取验证码" onclick="sendMessage1()">
</div>
</div>
<div class="code">验证码为：<span id="code">----</span></div>
<div class="aui-ver-button">
<button onclick="binding()">立即登录 / 注册</button>
</div>
<div class="aui-cell-box">
<label class="cell-right">
<input type="checkbox" value="1" name="checkbox" checked="checked">
<i class="cell-checkbox-icon"></i>
<em>同意快递e栈注册协议</em>
</label>
</div>
</div>
</section>
</section>
<script src="js/jquery.min.js"></script>
<script src="layer/layer.js"></script>
<script type="text/javascript">
	var phoneReg = /(^\d{11}$)/;
	var count = 30;
	var InterValObj1;
	var curCount1;
	function sendMessage1() {
		curCount1 = count;
		var userPhone = $.trim($('#phone1').val());
		if (!phoneReg.test(userPhone)) {
            layer.alert(" 请输入有效的手机号码",{icon:5});
			return false;
		}
		var id = layer.load();
        $.getJSON("/wx/getCode.do",{userPhone:userPhone},function (result) {
            layer.close(id);
            layer.msg(result.result);
            if(result.status === 0){
                $("#code").html(result.data);
            }
        });

		$("#btnSendCode1").attr("disabled", "true");
		$("#btnSendCode1").val( + curCount1 + "秒再获取");
		InterValObj1 = window.setInterval(SetRemainTime1, 1000);

	}
	function SetRemainTime1() {
		if (curCount1 == 0) {
			window.clearInterval(InterValObj1);
			$("#btnSendCode1").removeAttr("disabled");
			$("#btnSendCode1").val("重新发送");
		}
		else {
			curCount1--;
			$("#btnSendCode1").val( + curCount1 + "秒再获取");
		}
	}

	function binding(){
        if(!$(":checkbox").prop("checked")){
            layer.msg("未勾选协议,无法登陆");
            return;
        }

        var userPhone = $.trim($('#phone1').val());
        var code = $.trim($('#code1').val());
        if (!phoneReg.test(userPhone)) {
            layer.alert(" 请输入有效的手机号码",{icon:5});
            return false;
        }else if(code===""){
            layer.alert("请输入验证码",{icon:5});
            return false;
        }else if(code.length!==6){
            layer.alert("请输入六位数的验证码",{icon:5});
            return false;
        }else if(code.match(/^\d{6}/)==null){
            layer.alert("验证码请勿输入数字以外的字符",{icon:5});
            return false;
        }else {
            var id = layer.load();
            $.getJSON("/wx/login.do",{userPhone:userPhone,code:code},function (result) {
                layer.close(id);
                layer.msg(result.result);
                if(result.status === 0){
                    window.location.href="/wx/index.do?userPhone="+userPhone+"";
                }
            });
        }
		//alert("正在登陆")
        //window.location.href="index.html";
	}
</script>

</body></html>